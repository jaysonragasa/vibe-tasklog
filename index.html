<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clock In/Out Task Logger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Custom Glassmorphism Styles */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .dark .glass-card {
            background: rgba(30, 30, 30, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.8);
        }

        /* Basic styles for the contenteditable editor */
        [contenteditable]:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.5); /* focus:ring-2 focus:ring-blue-400 */
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans transition-colors duration-300">

    <div class="container mx-auto p-4 md:p-6 lg:p-8">

        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white">Task Logger</h1>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-sun text-yellow-500"></i>
                    <i class="fas fa-moon text-blue-500 hidden"></i>
                </button>
                 <button id="reset-button" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Reset All Data
                </button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Column: Controls & Calendar -->
            <div class="lg:col-span-1 flex flex-col gap-6">
                <!-- Clock Controls -->
                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold mb-4">Today's Clock</h2>
                    <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
                        <button id="clock-in-btn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i class="fas fa-play mr-2"></i> Clock In
                        </button>
                        <button id="clock-out-btn" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
                            <i class="fas fa-stop mr-2"></i> Clock Out
                        </button>
                    </div>
                </div>

                <!-- Calendar -->
                <div class="glass-card p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>
                        <h2 id="month-year" class="text-xl font-semibold"></h2>
                        <button id="next-month" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center"></div>
                </div>

                 <!-- Weekly Summary -->
                 <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold mb-4">Weekly Summary</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Total hours for the week of selected date:</p>
                    <div class="text-3xl font-bold text-blue-500 dark:text-blue-400" id="weekly-hours-total">0.00 hours</div>
                    <button id="export-week-btn" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-file-export mr-2"></i> Export Week
                    </button>
                </div>
            </div>

            <!-- Right Column: Daily Log -->
            <div class="lg:col-span-2 glass-card p-6 rounded-2xl">
                <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
                    <h2 class="text-xl font-semibold">Log for: <span id="selected-date-display" class="text-blue-500 dark:text-blue-400"></span></h2>
                    <div class="bg-gray-200 dark:bg-gray-700 p-3 rounded-lg text-center">
                        <span class="text-sm">Total Hours:</span>
                        <span id="daily-hours-total" class="font-bold text-lg ml-2">0.00</span>
                    </div>
                </div>

                <!-- Time Inputs -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="clock-in-time" class="block text-sm font-medium mb-1">Clock In Time</label>
                        <input type="time" id="clock-in-time" class="w-full bg-white/20 dark:bg-black/20 border-none rounded-lg p-2 focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div>
                        <label for="clock-out-time" class="block text-sm font-medium mb-1">Clock Out Time</label>
                        <input type="time" id="clock-out-time" class="w-full bg-white/20 dark:bg-black/20 border-none rounded-lg p-2 focus:ring-2 focus:ring-blue-400">
                    </div>
                </div>

                <!-- Task Logs -->
                <h3 class="font-semibold mb-2">Tasks</h3>
                <div id="task-list" class="space-y-3 mb-4 max-h-96 overflow-y-auto pr-2">
                    <!-- Tasks will be dynamically inserted here -->
                </div>

                <!-- New Task Editor -->
                <div class="mt-6">
                    <h3 class="font-semibold mb-2">Add New Task</h3>
                    <div class="bg-white/20 dark:bg-black/20 rounded-lg">
                        <div class="wysiwyg-toolbar p-2 border-b border-gray-300 dark:border-gray-600 flex items-center gap-2">
                            <button class="wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="bold"><i class="fas fa-bold"></i></button>
                            <button class="wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="italic"><i class="fas fa-italic"></i></button>
                            <button class="wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="underline"><i class="fas fa-underline"></i></button>
                            <button class="wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="insertUnorderedList"><i class="fas fa-list-ul"></i></button>
                            <button class="wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="insertOrderedList"><i class="fas fa-list-ol"></i></button>
                        </div>
                        <div id="new-task-editor" contenteditable="true" class="p-4 min-h-[100px] rounded-b-lg"></div>
                    </div>
                    <button id="add-task-btn" class="mt-4 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i> Add Task
                    </button>
                </div>

                <!-- Import/Export -->
                <div class="mt-8 border-t border-gray-300 dark:border-gray-600 pt-6 flex flex-col sm:flex-row gap-4">
                     <button id="import-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-file-import mr-2"></i> Import Logs
                    </button>
                    <input type="file" id="import-file" class="hidden" accept=".json">
                    <button id="export-btn" class="flex-1 bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-download mr-2"></i> Export All Logs
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Task Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="glass-card w-full max-w-2xl p-6 rounded-2xl animate-fade-in">
            <h2 class="text-xl font-semibold mb-4">Edit Task</h2>
            <div class="bg-white/20 dark:bg-black/20 rounded-lg">
                <div class="modal-wysiwyg-toolbar p-2 border-b border-gray-300 dark:border-gray-600 flex items-center gap-2">
                    <button class="modal-wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="bold"><i class="fas fa-bold"></i></button>
                    <button class="modal-wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="italic"><i class="fas fa-italic"></i></button>
                    <button class="modal-wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="underline"><i class="fas fa-underline"></i></button>
                    <button class="modal-wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="insertUnorderedList"><i class="fas fa-list-ul"></i></button>
                    <button class="modal-wysiwyg-btn p-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600" data-command="insertOrderedList"><i class="fas fa-list-ol"></i></button>
                </div>
                <div id="modal-task-editor" contenteditable="true" class="p-4 min-h-[150px] rounded-b-lg max-h-64 overflow-y-auto"></div>
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="cancel-edit-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Cancel</button>
                <button id="save-edit-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Save Changes</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    // STATE
    let logs = {};
    let selectedDate = new Date();
    let calendarDate = new Date();
    let editingTaskId = null;

    // DOM ELEMENTS
    const themeToggle = document.getElementById('theme-toggle');
    const clockInBtn = document.getElementById('clock-in-btn');
    const clockOutBtn = document.getElementById('clock-out-btn');
    const calendarGrid = document.getElementById('calendar-grid');
    const monthYearDisplay = document.getElementById('month-year');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const selectedDateDisplay = document.getElementById('selected-date-display');
    const clockInTimeInput = document.getElementById('clock-in-time');
    const clockOutTimeInput = document.getElementById('clock-out-time');
    const dailyHoursTotal = document.getElementById('daily-hours-total');
    const weeklyHoursTotal = document.getElementById('weekly-hours-total');
    const taskList = document.getElementById('task-list');
    const newTaskEditor = document.getElementById('new-task-editor');
    const addTaskBtn = document.getElementById('add-task-btn');
    const importBtn = document.getElementById('import-btn');
    const importFileInput = document.getElementById('import-file');
    const exportBtn = document.getElementById('export-btn');
    const exportWeekBtn = document.getElementById('export-week-btn');
    const resetButton = document.getElementById('reset-button');
    
    // Modal elements
    const editModal = document.getElementById('edit-modal');
    const modalTaskEditor = document.getElementById('modal-task-editor');
    const saveEditBtn = document.getElementById('save-edit-btn');
    const cancelEditBtn = document.getElementById('cancel-edit-btn');

    // --- INITIALIZATION ---
    function init() {
        loadLogs();
        setupTheme();
        setupEventListeners();
        renderCalendar();
        renderDailyLog();
        checkResetParam();
    }

    function checkResetParam() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('showReset') === 'true') {
            resetButton.classList.remove('hidden');
        }
    }

    function setupTheme() {
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeToggle.querySelector('.fa-sun').classList.add('hidden');
            themeToggle.querySelector('.fa-moon').classList.remove('hidden');
        } else {
            document.documentElement.classList.remove('dark');
            themeToggle.querySelector('.fa-sun').classList.remove('hidden');
            themeToggle.querySelector('.fa-moon').classList.add('hidden');
        }
    }

    function setupEventListeners() {
        themeToggle.addEventListener('click', toggleTheme);
        clockInBtn.addEventListener('click', clockIn);
        clockOutBtn.addEventListener('click', clockOut);
        prevMonthBtn.addEventListener('click', () => changeMonth(-1));
        nextMonthBtn.addEventListener('click', () => changeMonth(1));
        clockInTimeInput.addEventListener('change', updateTime);
        clockOutTimeInput.addEventListener('change', updateTime);
        addTaskBtn.addEventListener('click', addTask);
        importBtn.addEventListener('click', () => importFileInput.click());
        importFileInput.addEventListener('change', importLogs);
        exportBtn.addEventListener('click', exportLogs);
        exportWeekBtn.addEventListener('click', exportWeek);
        resetButton.addEventListener('click', resetAllData);

        // WYSIWYG event listeners
        document.querySelectorAll('.wysiwyg-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const command = btn.dataset.command;
                document.execCommand(command, false, null);
                newTaskEditor.focus();
            });
        });

        // Modal event listeners
        document.querySelectorAll('.modal-wysiwyg-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const command = btn.dataset.command;
                document.execCommand(command, false, null);
                modalTaskEditor.focus();
            });
        });
        saveEditBtn.addEventListener('click', saveTaskEdit);
        cancelEditBtn.addEventListener('click', closeEditModal);
        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) {
                closeEditModal();
            }
        });
    }

    // --- DATA HANDLING ---
    function loadLogs() {
        const storedLogs = localStorage.getItem('taskLogs');
        logs = storedLogs ? JSON.parse(storedLogs) : {};
    }

    function saveLogs() {
        localStorage.setItem('taskLogs', JSON.stringify(logs));
        renderCalendar();
        renderDailyLog();
    }

    function getDateKey(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function getDayLog(date) {
        const key = getDateKey(date);
        if (!logs[key]) {
            logs[key] = { clockIn: null, clockOut: null, tasks: [] };
        }
        return logs[key];
    }
    
    // --- THEME ---
    function toggleTheme() {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        setupTheme();
    }
    
    // --- CLOCK & TIME ---
    function clockIn() {
        const now = new Date();
        const todayLog = getDayLog(now);
        if (todayLog.clockIn === null) {
            todayLog.clockIn = now.toISOString();
            selectedDate = now; // Switch view to today
            saveLogs();
        } else {
            alert("You have already clocked in for today.");
        }
    }

    function clockOut() {
        const now = new Date();
        const todayLog = getDayLog(now);
        if (todayLog.clockIn !== null && todayLog.clockOut === null) {
            todayLog.clockOut = now.toISOString();
            selectedDate = now; // Switch view to today
            saveLogs();
        } else if (todayLog.clockIn === null) {
            alert("You need to clock in first.");
        } else {
            alert("You have already clocked out for today.");
        }
    }

    function updateTime(event) {
        const dayLog = getDayLog(selectedDate);
        const [hours, minutes] = event.target.value.split(':');
        const newDate = new Date(selectedDate);
        newDate.setHours(hours, minutes, 0, 0);

        if (event.target.id === 'clock-in-time') {
            dayLog.clockIn = newDate.toISOString();
        } else {
            dayLog.clockOut = newDate.toISOString();
        }
        saveLogs();
    }

    // --- CALENDAR ---
    function renderCalendar() {
        calendarGrid.innerHTML = '';
        calendarDate.setDate(1);
        monthYearDisplay.textContent = new Intl.DateTimeFormat(navigator.language, { month: 'long', year: 'numeric' }).format(calendarDate);
        
        const firstDayOfMonth = calendarDate.getDay();
        const daysInMonth = new Date(calendarDate.getFullYear(), calendarDate.getMonth() + 1, 0).getDate();

        // Weekday headers
        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        weekdays.forEach(day => {
            const dayEl = document.createElement('div');
            dayEl.className = 'font-semibold text-sm text-gray-500';
            dayEl.textContent = day;
            calendarGrid.appendChild(dayEl);
        });
        
        // Blank days
        for (let i = 0; i < firstDayOfMonth; i++) {
            calendarGrid.appendChild(document.createElement('div'));
        }

        // Calendar days
        for (let day = 1; day <= daysInMonth; day++) {
            const dayEl = document.createElement('button');
            dayEl.textContent = day;
            const date = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), day);
            const dateKey = getDateKey(date);

            let classes = 'p-2 rounded-full aspect-square flex items-center justify-center transition-colors ';
            if (dateKey === getDateKey(new Date())) {
                classes += 'bg-blue-500 text-white ';
            } else if (dateKey === getDateKey(selectedDate)) {
                 classes += 'bg-blue-200 dark:bg-blue-800 ';
            } else {
                classes += 'hover:bg-gray-200 dark:hover:bg-gray-700 ';
            }

            if (logs[dateKey] && (logs[dateKey].clockIn || logs[dateKey].tasks.length > 0)) {
                classes += ' border-2 border-green-400 dark:border-green-500';
            }
            
            dayEl.className = classes;
            dayEl.addEventListener('click', () => {
                selectedDate = date;
                renderDailyLog();
                renderCalendar();
            });
            calendarGrid.appendChild(dayEl);
        }
    }

    function changeMonth(offset) {
        calendarDate.setMonth(calendarDate.getMonth() + offset);
        renderCalendar();
    }

    // --- DAILY LOG & TASKS ---
    function renderDailyLog() {
        selectedDateDisplay.textContent = new Intl.DateTimeFormat(navigator.language, { dateStyle: 'long' }).format(selectedDate);
        const dayLog = getDayLog(selectedDate);
        
        clockInTimeInput.value = dayLog.clockIn ? new Date(dayLog.clockIn).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' }) : '';
        clockOutTimeInput.value = dayLog.clockOut ? new Date(dayLog.clockOut).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' }) : '';
        
        renderTaskList();
        calculateHours();
    }

    function renderTaskList() {
        taskList.innerHTML = '';
        const dayLog = getDayLog(selectedDate);
        if (dayLog.tasks.length === 0) {
            taskList.innerHTML = `<p class="text-gray-500 italic">No tasks logged for this day.</p>`;
            return;
        }

        dayLog.tasks.forEach(task => {
            const taskEl = document.createElement('div');
            taskEl.className = 'p-3 rounded-lg bg-white/30 dark:bg-black/30 flex justify-between items-start';
            
            const contentEl = document.createElement('div');
            contentEl.innerHTML = task.content;
            contentEl.className = 'prose dark:prose-invert max-w-none';
            
            const actionsEl = document.createElement('div');
            actionsEl.className = 'flex space-x-2 ml-4 flex-shrink-0';
            
            const editBtn = document.createElement('button');
            editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
            editBtn.className = 'text-blue-500 hover:text-blue-700 p-2';
            editBtn.onclick = () => openEditModal(task.id);

            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
            deleteBtn.className = 'text-red-500 hover:text-red-700 p-2';
            deleteBtn.onclick = () => deleteTask(task.id);

            actionsEl.appendChild(editBtn);
            actionsEl.appendChild(deleteBtn);
            
            taskEl.appendChild(contentEl);
            taskEl.appendChild(actionsEl);
            taskList.appendChild(taskEl);
        });
    }

    function addTask() {
        const content = newTaskEditor.innerHTML.trim();
        if (!content) return;

        const dayLog = getDayLog(selectedDate);
        dayLog.tasks.push({
            id: Date.now(),
            content: content
        });
        newTaskEditor.innerHTML = '';
        saveLogs();
    }

    function deleteTask(taskId) {
        if (!confirm('Are you sure you want to delete this task?')) return;
        const dayLog = getDayLog(selectedDate);
        dayLog.tasks = dayLog.tasks.filter(t => t.id !== taskId);
        saveLogs();
    }

    function openEditModal(taskId) {
        const dayLog = getDayLog(selectedDate);
        const task = dayLog.tasks.find(t => t.id === taskId);
        if (task) {
            editingTaskId = taskId;
            modalTaskEditor.innerHTML = task.content;
            editModal.classList.remove('hidden');
        }
    }
    
    function closeEditModal() {
        editingTaskId = null;
        editModal.classList.add('hidden');
    }

    function saveTaskEdit() {
        if (!editingTaskId) return;

        const content = modalTaskEditor.innerHTML.trim();
        if (!content) {
            alert("Task content cannot be empty.");
            return;
        }

        const dayLog = getDayLog(selectedDate);
        const task = dayLog.tasks.find(t => t.id === editingTaskId);
        if (task) {
            task.content = content;
            saveLogs();
        }
        closeEditModal();
    }

    // --- CALCULATIONS ---
    function calculateHours() {
        // Daily
        const dayLog = getDayLog(selectedDate);
        let dailyHours = 0;
        if (dayLog.clockIn && dayLog.clockOut) {
            const start = new Date(dayLog.clockIn);
            const end = new Date(dayLog.clockOut);
            if (end > start) {
                dailyHours = (end - start) / 1000 / 60 / 60;
            }
        }
        dailyHoursTotal.textContent = dailyHours.toFixed(2);

        // Weekly
        let weeklyHours = 0;
        const startOfWeek = new Date(selectedDate);
        startOfWeek.setDate(selectedDate.getDate() - selectedDate.getDay()); // Assuming Sunday is start of week
        
        for (let i = 0; i < 7; i++) {
            const date = new Date(startOfWeek);
            date.setDate(startOfWeek.getDate() + i);
            const log = logs[getDateKey(date)];
            if (log && log.clockIn && log.clockOut) {
                const start = new Date(log.clockIn);
                const end = new Date(log.clockOut);
                 if (end > start) {
                    weeklyHours += (end - start) / 1000 / 60 / 60;
                }
            }
        }
        weeklyHoursTotal.textContent = `${weeklyHours.toFixed(2)} hours`;
    }
    
    // --- IMPORT/EXPORT & RESET ---
    function importLogs(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedLogs = JSON.parse(e.target.result);
                // Simple validation
                if (typeof importedLogs !== 'object' || importedLogs === null) throw new Error("Invalid format");
                
                // Merge logs
                Object.assign(logs, importedLogs);
                saveLogs();
                alert('Logs imported successfully!');
            } catch (error) {
                alert('Error importing file. Please ensure it is a valid JSON file from this app.');
            }
        };
        reader.readAsText(file);
    }
    
    function exportLogs() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", `task_logs_export_${getDateKey(new Date())}.json`);
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
    
    function exportWeek() {
        const startOfWeek = new Date(selectedDate);
        startOfWeek.setDate(selectedDate.getDate() - selectedDate.getDay());
        let exportText = `Weekly Log for the week starting ${startOfWeek.toLocaleDateString()}\n\n`;
        let totalHours = 0;

        for (let i = 0; i < 7; i++) {
            const date = new Date(startOfWeek);
            date.setDate(startOfWeek.getDate() + i);
            const dateKey = getDateKey(date);
            const log = logs[dateKey];

            exportText += `--- ${date.toLocaleDateString(navigator.language, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} ---\n`;
            
            if (log) {
                const clockInTime = log.clockIn ? new Date(log.clockIn).toLocaleTimeString() : 'N/A';
                const clockOutTime = log.clockOut ? new Date(log.clockOut).toLocaleTimeString() : 'N/A';
                
                exportText += `Time In: ${clockInTime}\n`;
                exportText += `Time Out: ${clockOutTime}\n`;

                let dayHours = 0;
                 if (log.clockIn && log.clockOut) {
                    const start = new Date(log.clockIn);
                    const end = new Date(log.clockOut);
                    if (end > start) {
                        dayHours = (end - start) / 1000 / 60 / 60;
                        totalHours += dayHours;
                    }
                }
                exportText += `Daily Hours: ${dayHours.toFixed(2)}\n\n`;

                if (log.tasks.length > 0) {
                    exportText += 'Tasks:\n';
                    log.tasks.forEach(task => {
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = task.content;
                        exportText += `- ${tempDiv.textContent || tempDiv.innerText || ""}\n`;
                    });
                }
            } else {
                exportText += "No data logged.\n";
            }
            exportText += "\n";
        }
        exportText += `------------------\nTotal Weekly Hours: ${totalHours.toFixed(2)}\n`;

        const dataStr = "data:text/plain;charset=utf-8," + encodeURIComponent(exportText);
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", `weekly_log_${getDateKey(startOfWeek)}.txt`);
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function resetAllData() {
        if (confirm('DANGER: This will delete ALL your logs permanently. Are you absolutely sure?')) {
            localStorage.removeItem('taskLogs');
            logs = {};
            selectedDate = new Date();
            calendarDate = new Date();
            saveLogs(); // This will re-render everything
            alert('All data has been reset.');
        }
    }

    // --- START THE APP ---
    init();
});
</script>

</body>
</html>
